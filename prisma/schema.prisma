generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id               String   @id @default(uuid())
  name             String
  email            String   @unique
  password         String
  role             Role     @default(TENANT)
  isActive         Boolean  @default(false)
  activationToken  String?
  resetToken       String?
  resetTokenExpiry DateTime?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  tenant           Tenant?
  caretaker        Caretaker?
}

model Tenant {
  id               String   @id @default(uuid())
  userId           String   @unique
  phone            String?
  nationalId       String?
  emergencyContact String?

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  leases           Lease[]
}

model Unit {
  id          String   @id @default(uuid())
  unitNumber  String
  building    String
  description String   // single room, bedsitter, studio etc.
  rentAmount  Float
  status      UnitStatus @default(AVAILABLE)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  leases      Lease[]

  @@unique([unitNumber, building])
}

model Lease {
  id            String   @id @default(uuid())

  tenantId      String
  unitId        String

  startDate     DateTime
  endDate       DateTime?   // null = open-ended lease

  depositAmount Float
  depositPaid   Boolean  @default(false)

  status        LeaseStatus @default(ACTIVE)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  tenant        Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  unit          Unit   @relation(fields: [unitId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([unitId])
}

model Caretaker {
  id           String   @id @default(uuid())
  userId       String   @unique
  phone        String?
  assignedArea String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  CARETAKER
  TENANT
}

enum UnitStatus {
  AVAILABLE
  OCCUPIED
}

enum LeaseStatus {
  ACTIVE
  TERMINATED
}
